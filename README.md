# Multi-Scene long video generation

由于数据集稀少以及算力原因，本工作目前还属于遗弃阶段。我目前只训练了3天，发现场景是可以保持一致性的。

给定的4个文本描述分别为：

1. 'Actor 1 is running on the playground.'

2. 'Actor 2 is skiing on the snow.' 

3. 'Actor 2 is running on the playground.'

4.  'Actor 1 is skiing on the snow.'

   生成的视频效果：

   <video width="720" height="480" controls>
       <source src="./asset/result.mp4" type="video/mp4">
   </video>

   其中，可以看到场景基本保持一致，人物还没有保持一致，但这很有可能是训练不充分以及数据集的问题，需要注意的是这只在1000个视频、vGPU(48GB)上训练了3天达到的效果，也可以看到，我们的方法确实在尽可能的保证人物的一致性，第3个场景的人物部分是红色衣服，与第2个场景的红色衣服对应。第4个场景的人物穿了绿衣服与第一个场景的绿衣服对应。

   如果你能接受这一结果，后续将向您介绍完整的pipline，并且我们提供了完整可训练的代码。

   【注】如果您使用了我的Pipline并进行了部分修改，且想要发paper，希望能挂我个3、4、5作（谢谢，这对研0的我至关重要:joy:）。联系我：3475287084@qq.com，QQ：3475287084，备注您的来意，谢谢，谢谢，谢谢:kissing_heart::kissing_heart::kissing_heart:。

   ## 1. pipline介绍

![image-20250628103157341](./asset/pipline.png)

我们的任务是根据过去的文本提示![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJsAAAAoCAMAAADe4XhlAAAAAXNSR0IArs4c6QAAAHhQTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOgA6OjoAOjpmOmaQOma2OpC2OpDbZgAAZjoAZpC2ZrbbZrb/kDoAkNv/tmYAtmY6tpBmttvbttv/tv/btv//25A627Zm27aQ2////7Zm/9uQ/9u2/9vb//+2///bIhC3vQAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACWElEQVRYR+1X2ULDIBAMrQfe1RqxHmkl2vz/H8q5bMLSxTcf4KnNsOxk2B1I17XRFGgKNAWaAk2BpkBToClAKjDtrsXlv9FGi9XtW2QzytXW/dbCj5t3miiHM69XHf7diwe/1tSL57DqXqw/u+4g4cEiG4cz5KrDp3714tYapSUUhLv4Mj+G0g5rcRpnhasNH4Jwo3QRdoRHgUKeicMZbvXhiRvopvxmDl6efHA4w60+PHI7bsLmmsrzv1QsxUUuDmeo/SE8vIWlEnoh7K52HUEMDme41YdDLyRu2vbAz05GHZe5OJxthdPLp/CpD+ocZPRd5dzt7IkuNivwaZwtt+pwLe4NCeNuweeg3EopktIMCRqehatC2cTQ0XvsQd75J8cNCthfefdDA+H2lBPnheOjwBwvP/WEE6CUWl76zVOhvpCtHR6JfkC4Elvs2VU6Fl3TR+OUUG/QC9FUzMF69zXkoie8U7ZE4ztVMQNjL8yepQSJYx2gc9XEAzfXnHbMccvN0Qfc1IStEe9AYN9k+CCoEzvJAakiyb3Elptzm+O2PB3pWm6zcGJXkBzJ/cESTYfHliV0czechBsZfTlXcpuHKxfrPckMXz+IMHHWo1qAiQN9YYJyLeBxKRI+btBLQlKC28w6sonHTXCYeQ1Pau0dpIDH2TQ8ynhjxKsibvl5Sk0cqDdEPVrAQTYyfCBPxcQtyWUuIv5OjoZp3uwZgrXbaEW9/XIl6r9af7xmsSnl92Oqo+xbxrjBovKXzB1euhOw9HT8QkkzU0r7LfO3E4fN1yb8FwV+ARQWME99YsZlAAAAAElFTkSuQmCC)以及视频片段![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJoAAAAoCAMAAAAxIxNbAAAAAXNSR0IArs4c6QAAAHJQTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgA6OjoAOmaQOma2OpC2OpDbZgAAZjoAZrbbZrb/kDoAkJA6kNv/tmYAtmY6tpBmttvbttv/tv+2tv/btv//25A627Zm27aQ2////7Zm/9uQ/9u2//+2///bY1UR9wAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACX0lEQVRYR+1X22LbIAw1SVdv7eam3li7i5fi2P//ixMgcTFyhd/6AE8O8pFODrrgrmurKdAUaAo0BZoCTYGmQFPAK7C+fFH3H0UMo04Pr0Rm7k8X4Dcqpc5/u24Z4OHT24aqYJb+2BH4bVTfULNRPdun26DOv+zD3JfMRLPETfCewdfx9MNtzL3VCpbGU10G3MjDCWaJ2xH4hLLNPZ7ehNSMV3G7BLNE7Qg8UkORELyORaK5sIK5ktqe9wxO1JYBT9Z41Sb8uY0lmCVqR+Cazo0ejMv+ZcDyKKm9a5apVcNDGUD6+9zySafZGpDNEjXBewpfR+Rw7bHdOvDcszVA1PbNVdQq4UZ9BZGgF9IBWmrvZKlgrqEWvO8eDXqB1moVuvaPfsP2M0M18O+z73pxJWY72dSd68/VK/XOCpBENP09qAZLIx0A/8YauD65mbWlRmatLrFTV5JLvHOINGLItVAGAP7uCZnHt4mjhuZO2+ykf1RPjeAMIosYxlEoVTuCQw0QNWxH4C0zW2qOfLTDtQDQxsk90RRm4VMSJ9KMYkAkzyPhmIx1llo6JpbBFfYRagFeHgl4Sjb1doZmR1RSy0+QMrmaWgrXroHC3cstmpMxhYrxnqUAUZv4WR8ydcdOvlgzP3AS1eIM5fo/vrgM2Fny1F21v9pBNrB2eps38403O1DM+TBM0/D44sQP1FCdO/YgGgvnLxCRWrwwwtXjsq1nKNtiL77jb3R6b6RJ7USf//wssDHi7SkmUfHZ4j4PVJhgJW9n3rk8ScSgqt3HSLZiRPvZcmzOyAHbGx9Bgf8oJTJ73YI9DAAAAABJRU5ErkJggg==)以及当前的文本提示![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAMAAADJ7yrpAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOjpmOpDbZgAAZpC2ZrbbZrb/kDoAkNv/tmYAtmY6tpBmttv/tv/btv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///b2R0GjwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAApElEQVQ4T+2QyxLCMAhFQ6uiVWt8UUXb//9MTSCFjDvHpWwSEjjcSwj/+PUGGCTWZ08eoL2GcEPYu1eG5f2dEqzcI8EmZfqnH1H6SBokpr45pDNKg8QDcwXncSU4DXieUOpnZFK52BrQkLkkKmLsjDX1KqCWp0iV7oYkpFkm0PuATjMJPu9tdhKd0cIbO2fUDPuNFiGV02K4vRw/ahmbXaX3q+QFgwIGVYNkoR8AAAAASUVORK5CYII=)自回归的生成![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAoCAMAAAArMzGQAAAAAXNSR0IArs4c6QAAAFFQTFRFAAAAAAAAAAA6AABmADqQAGa2OgAAOpDbZgAAZrbbZrb/kDoAkJA6kNv/tmYAtmY6ttv/tv+2tv/btv//25A62////7Zm/9uQ/9u2//+2///bveCXGgAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAoklEQVQ4T+1QSRbCIAxNiiJapdoiSO9/UBMIk0vdmlXez/AHgH/9lMA+I6LaAKKh5vBMz14G1Z2boAsEYPGYhtHwei4nmMdLVSHYPsszHvi856ZbE+vT62hOnf6gGbONIGkgLOhGIFglkHXW5YWgzAh7DARZ/3UgIIxTEAJXOsKqA1cObHNgO39iYTSTwQ/lObY+B7m1al0Gjxybns5dOl+0b6mVBqLtUFOsAAAAAElFTkSuQmCC)，即：![img](data:image/png;base64,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)。我们的pipline分为4个模块：文本筛选模块、文本图像注意力抽取模块、文本图像解耦模块、视频生成模块。

## 1.1 文本筛选模块

随着![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAoCAMAAAArMzGQAAAAAXNSR0IArs4c6QAAAFFQTFRFAAAAAAAAAAA6AABmADqQAGa2OgAAOpDbZgAAZrbbZrb/kDoAkJA6kNv/tmYAtmY6ttv/tv+2tv/btv//25A62////7Zm/9uQ/9u2//+2///bveCXGgAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAoklEQVQ4T+1QSRbCIAxNiiJapdoiSO9/UBMIk0vdmlXez/AHgH/9lMA+I6LaAKKh5vBMz14G1Z2boAsEYPGYhtHwei4nmMdLVSHYPsszHvi856ZbE+vT62hOnf6gGbONIGkgLOhGIFglkHXW5YWgzAh7DARZ/3UgIIxTEAJXOsKqA1cObHNgO39iYTSTwQ/lObY+B7m1al0Gjxybns5dOl+0b6mVBqLtUFOsAAAAAElFTkSuQmCC)的生成，当![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAoCAMAAAD0fUuPAAAAAXNSR0IArs4c6QAAAD9QTFRFAAAAAAAAAAA6AABmADqQAGa2OgAAOpDbZgAAZrbbZrb/kDoAkNv/tmYAtpA6tv//2////7Zm/9uQ//+2///bidrZ8AAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAS0lEQVQoU2NgGMyAl5Ed7DwRbiYerO4U5mCEKhHmgCoR5mDmB6sVYmMRADMEoUoYeBm5oMZhKmGFmC/IyCrCB7JUhJuRiROinxoAAAajAgkNAFWrAAAAAElFTkSuQmCC)很大时，模型容易产生遗忘重要信息，与FramePack和WorldMEM[4]的想法相同，与其让模型被动遗忘重要信息，不如让模型主动遗忘无用信息，这就是文本筛选模块的目标。

这是个NLP任务，目标是根据![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAMAAADJ7yrpAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOjpmOpDbZgAAZpC2ZrbbZrb/kDoAkNv/tmYAtmY6tpBmttv/tv/btv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///b2R0GjwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAApElEQVQ4T+2QyxLCMAhFQ6uiVWt8UUXb//9MTSCFjDvHpWwSEjjcSwj/+PUGGCTWZ08eoL2GcEPYu1eG5f2dEqzcI8EmZfqnH1H6SBokpr45pDNKg8QDcwXncSU4DXieUOpnZFK52BrQkLkkKmLsjDX1KqCWp0iV7oYkpFkm0PuATjMJPu9tdhKd0cIbO2fUDPuNFiGV02K4vRw/ahmbXaX3q+QFgwIGVYNkoR8AAAAASUVORK5CYII=)的toekn筛选出![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGkAAAAoCAMAAADKWCTBAAAAAXNSR0IArs4c6QAAAGZQTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOgA6OjpmOma2OpDbZgAAZjoAZpC2ZrbbZrb/kDoAkNv/tmYAtmY6tpBmttv/tv/btv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///bgvd8vgAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAABPklEQVRYR+1V21aDMBAkUk1FtNLYaoDQ8P8/aS5cwmELTnzxeLKPJLOTnZ1dsixFUiApkBRICiQF/qYCivl4vsa8D0LXLP/Ksoaz9xgqBK3YY2s4JHuKYULQkr1YigGCsiFo4WWTvjQ0AHRfPZxteuFLAwNBd9zVopwv4EDQyjrhduG+MjQQtHDTdHiLaZLV/MfoUWi0GH9/gRbb+usyOK+PoIQhuq8o884pgzFqXmFX7A1hmHKYPOu+opWo/2Y0qX6Ysq/CdTcxOUu50KW94GdgGu7xOERLRi7OKWXNw4FFmRZoWpDxq1v6824AmZZo4QzhbW9iaMSdhkyf5fYvhDrWJbnNdph0WWzNF3nccdPPdewwye1lSx5Lep3RTGbiT3G7wjYo//xYV0WmNH5e+gMjVXz9zF+mxB7wj29/A106FZn1kcHzAAAAAElFTkSuQmCC)中与![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAMAAADJ7yrpAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOjpmOpDbZgAAZpC2ZrbbZrb/kDoAkNv/tmYAtmY6tpBmttv/tv/btv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///b2R0GjwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAApElEQVQ4T+2QyxLCMAhFQ6uiVWt8UUXb//9MTSCFjDvHpWwSEjjcSwj/+PUGGCTWZ08eoL2GcEPYu1eG5f2dEqzcI8EmZfqnH1H6SBokpr45pDNKg8QDcwXncSU4DXieUOpnZFK52BrQkLkkKmLsjDX1KqCWp0iV7oYkpFkm0PuATjMJPu9tdhKd0cIbO2fUDPuNFiGV02K4vRw/ahmbXaX3q+QFgwIGVYNkoR8AAAAASUVORK5CYII=) token语义最接近的token，如：![img](data:image/png;base64,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)，文本筛选模块会将![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAoCAMAAAAi2JHqAAAAAXNSR0IArs4c6QAAAHVQTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOjoAOjpmOmaQOma2OpDbZgAAZjo6ZpC2ZrbbZrb/kDoAkDo6kLb/kNv/tmYAtpBmttv/tv//25A625Bm27Zm27aQ29u22////7Zm/9uQ/9u2/9vb//+2///buuEIlwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAvklEQVQ4T+1RyRaCMAxMwKVuuFQtWAGLwP9/orYptaW859GLc+skmcykAH/8+gIKCeti5KTE9AZQMTyFBYWLx5uRuAx5iTtN2PKnJkhA0phDz5Orfggac2iY6VNmuwel97U5oylfXrufHQJxgEE+bAboMqfb5ivEuY3t2ZZ4hGZos6lMAh1Y0HjPw7P0nNKVLIhTnzeGNkd2ObsMk7Ff67Oi9DHk+BsA7hdtKuZFWsAzi3WqPWKynZaf3PmVfAFNjQm9RyKSEwAAAABJRU5ErkJggg==)的token与![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAoCAMAAAAi2JHqAAAAAXNSR0IArs4c6QAAAGBQTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOgA6OjpmOma2OpDbZgAAZjoAZpC2ZrbbZrb/kDoAkNv/tmYAtpBmttv/tv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///bTQiSgAAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAApUlEQVQ4T+1RywKCMAxrfU0UH4i4wRT+/y+hG3RdPXHyYm5L27TJAP74dQIeI4pGXeJw+wJoDd7zgsd9NzEWDzlv8UzEXE61OgrYOMYYqs2DHnUcY7xN6PNhu4CnfZ+niVNSnq7fXTNxgEVex9uXQtcdWUyc3V7E7tkVXXTqLM8OlYwl8c5IO8yHkJPP1K8iVJ6X6sr+yftN+wboy/DPedrfbWuYEaQyBzn/jmQjAAAAAElFTkSuQmCC)和![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAoCAMAAAAi2JHqAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOjoAOjpmOpDbZgAAZpC2ZrbbZrb/kDoAkNv/tmYAtpBmttv/tv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///bVn4hAgAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAsklEQVQ4T+1RywLCIAxrnQ/UqdgpU+b4/8/UtojQmycv5kb6SgLAH79OIKJidzFKRuyuADeHp7YQcX1/MQE3LR9wz0Quf2qkC4KOFSS/OPODdKxgctIX5XqFyPceg9Opej2rXx6a5QDv9TbeuS9707BFXGXblWzCI0wut2VXopQNk95P3sRC2j+61s7cS0oScuUz+TaMrDJ5Y1r5RJ39HOGzFmsxijQy38aSGTY/O/3N+wm2bwd2zBjJnQAAAABJRU5ErkJggg==)的token之间的相似度，然后通过阈值的方法，筛选出过去对![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAoCAMAAAAi2JHqAAAAAXNSR0IArs4c6QAAAHVQTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOjoAOjpmOmaQOma2OpDbZgAAZjo6ZpC2ZrbbZrb/kDoAkDo6kLb/kNv/tmYAtpBmttv/tv//25A625Bm27Zm27aQ29u22////7Zm/9uQ/9u2/9vb//+2///buuEIlwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAvklEQVQ4T+1RyRaCMAxMwKVuuFQtWAGLwP9/orYptaW859GLc+skmcykAH/8+gIKCeti5KTE9AZQMTyFBYWLx5uRuAx5iTtN2PKnJkhA0phDz5Orfggac2iY6VNmuwel97U5oylfXrufHQJxgEE+bAboMqfb5ivEuY3t2ZZ4hGZos6lMAh1Y0HjPw7P0nNKVLIhTnzeGNkd2ObsMk7Ff67Oi9DHk+BsA7hdtKuZFWsAzi3WqPWKynZaf3PmVfAFNjQm9RyKSEwAAAABJRU5ErkJggg==)有帮助的信息，如![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAoCAMAAAAi2JHqAAAAAXNSR0IArs4c6QAAAGBQTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOgA6OjpmOma2OpDbZgAAZjoAZpC2ZrbbZrb/kDoAkNv/tmYAtpBmttv/tv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///bTQiSgAAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAApUlEQVQ4T+1RywKCMAxrfU0UH4i4wRT+/y+hG3RdPXHyYm5L27TJAP74dQIeI4pGXeJw+wJoDd7zgsd9NzEWDzlv8UzEXE61OgrYOMYYqs2DHnUcY7xN6PNhu4CnfZ+niVNSnq7fXTNxgEVex9uXQtcdWUyc3V7E7tkVXXTqLM8OlYwl8c5IO8yHkJPP1K8iVJ6X6sr+yftN+wboy/DPedrfbWuYEaQyBzn/jmQjAAAAAElFTkSuQmCC)的’猫’和![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAoCAMAAAAi2JHqAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOjoAOjpmOpDbZgAAZpC2ZrbbZrb/kDoAkNv/tmYAtpBmttv/tv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///bVn4hAgAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAsklEQVQ4T+1RywLCIAxrnQ/UqdgpU+b4/8/UtojQmycv5kb6SgLAH79OIKJidzFKRuyuADeHp7YQcX1/MQE3LR9wz0Quf2qkC4KOFSS/OPODdKxgctIX5XqFyPceg9Opej2rXx6a5QDv9TbeuS9707BFXGXblWzCI0wut2VXopQNk95P3sRC2j+61s7cS0oScuUz+TaMrDJ5Y1r5RJ39HOGzFmsxijQy38aSGTY/O/3N+wm2bwd2zBjJnQAAAABJRU5ErkJggg==)的自行车对应的token。

### 1.2 文本对应的图像语义（注意力）抽取模块

由于每个视频片段都是单镜头单场景单人物的视频，视频内容变化不大，所以我们选择视频片段中的第一帧（或某一帧）作为锚点（关键帧）用于表示这个片段的视觉语义信息。

我们需要在更细粒度的token级别而非Prompt级别进行图像语义抽取，即根据过去有用的token ![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKcAAAAoCAMAAACsLhrTAAAAAXNSR0IArs4c6QAAAIFQTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgA6OjoAOmaQOma2OpC2OpDbZgAAZgA6ZjoAZjo6ZpC2ZpDbZrbbZrb/kDoAkDo6kLb/kNv/tmYAtpBmttvbttv/tv//25A625Bm27Zm27aQ29u22////7Zm/9uQ/9u2/9vb//+2///bQwujEgAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACpElEQVRYR+1X7XbTMAytM2jGCqHACCx8eC1LSvL+D4gs25LTyFHzj7Nj/dja3ki+vtaHs9sVKwoUBYoCRYGiQFGgKFAUeDUKTD/emf1/uZveVA8/I7Ohrh7hc2/Y3r4saCuw5q7IkI1+ac0H7zu15qv737kf8M9JUleBNXeFZz761FZP6DzUd7+RLhy95zzUSHxmCqy5KzTXotsg6FDjKY8fgfbYOM7Dvd9BagqsuSs816IzT9QTrTdCZvIaCqy5K2Qz0SPPsQkJAGHset0rsOau8MxE73z5uNqhdEw+SkEVOI2kcLo9OtVREj2VVoikwJDdfDLbeWa8pzak5bmmHh9KP7eGAsfOsZ0ieuSi9+Y91Dl0otBHsYxWx5ICa+5qGWUWH2pMzHN9iBGw26KdhNbkWzmYm7Pmza/FuhH/m8HXiVL01nADcuLVez8du5hVlLLn4/xRvwDBnXmUTolw63DsxBuM6wWbPhnlJ9eR7/Kwg8OLFVaJ8K5zcWh3FJFwi/hGnuQN5ciZGEdPKlPapolnkpPzPhx45PCpxYnB8Ni4LOvxoGwcJ6K3G4fWxFKJ148wK5Ewn7bAM4XdNv3h8Eoz/M+3B0yqm3km3m7tsaH8j3kb5rujaYjokucMhofDgCUiKQ7aVZ838Uy9u/10unc3TW9X95B5yhNPy8NKTG4Zd10EN5KDicPyZgabNOm84PkuZHzkOTbUtFKa3V3oSjLuZQAKeRijiTDcKmcXS2m+s9iBu01Lj1CudRF//h55yu68ihTdVk8x+f1eoowwWDkbfAxoZtc/JXL2mAvd8sjCM07tS7N6Q5xn2exbB47QTJ49gcuRE+/6Pc5lCJgoJW4C4fyd4/wJ0MPyFWuFHEPY5S/H6ov7yb3HLefeTXHKQ69BgX9Xxzw4n4pYMQAAAABJRU5ErkJggg==)及token对应的图像![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJcAAAAoCAMAAADE3ZjrAAAAAXNSR0IArs4c6QAAAH5QTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgA6OjoAOmaQOma2OpC2OpDbZgAAZjoAZjo6ZpC2ZpDbZrbbZrb/kDoAkDo6kLb/kNv/tmYAtpBmttvbttv/tv//25A625Bm27Zm27aQ29u22////7Zm/9uQ/9u2/9vb//+2///b2QlmCwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACdklEQVRYR+1XXXfaMAyN0410sIW1a7ZmHy6sCUv+/x+cbEuygxXR9onT4xwewrlIvpavrkxVladUoFSgVKBUoFSgVKBU4B1XYP75yWyuYn+Dqbe/iMnY1N/8+2DgeRAJKpAWdmGzQtZTZ76EqLljLgdjAsP8UaBKw3RmQuTc1Y8+aGxu/mD0YD4+ryRSICjYatjFguWRFgs2NozZdZkpUKVhOjEpMvLievV0tnk2Bao0TOclRRKvqcUDBaXRW5ZNgbSwC8coZu1J7vySKO08oQKlAn2l2UhZI1fmNazLS4FA9m81Pyly7lBWx4bSXoW8YJufwRTAvdDHrkRezri8wo7NLshiarGCh9vgbPFByA0s8+G3iP2TMF1vlLUz7AgQMDSbYKI9diHa43G/+Jn/CUI9jINMq4hZh9HOXqZ/8uO5SwTK+gL7CTMxGMewe7Yp/QSqehdP26C10W+sx7JIjWF0KpJSemrUmHFOEi9ul2SE0toiNnd+dDA2tW7Lg6+/pWGVR46gG2uwq3ktktWhoQ7IeEXIqdAXnbMn2N/vW6+MF/LiSLfe1JJuyRVwPvo7R6jnOa8EgqYN05TWjhgUp757Ba8Y2W/mwy1fZIS5jWIgXja/jLEqBcy1tictYiy0DIUNmWQARtWdixV5TS0aSNTu3N8ElxCw0DqgpxUMs+To2DzAhxfJ5yN3WCBqky5BiHsxx55+EC8hLunKHLX1I4o27JjKBBeKxS0VGnTl1jr4g+3Fq7ar5Kl9ywWxhyAwmCe/6GkfxbP43+FOmzsg2Se8Qgu7R74MHb8Cslu77i4TLb55Vz3t63vfTfX2bJwokQW6+gr8B4thMsMsCrrkAAAAAElFTkSuQmCC)抽取![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAoCAMAAAArMzGQAAAAAXNSR0IArs4c6QAAAFdQTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOjpmOpDbZgAAZpC2ZpDbZrb/kDoAkNv/tmYAtpBmttv/tv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///bVHJ6hwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAlklEQVQ4T+2QyxbCIAxESdVGUVsfoCD+/3dakpDg0tOts4JJuJng3F9rfyABa3/rSBE2d+ceCGczE+yeyy3AaF6AQ71Iif0LPwrcTnpPw8wlaidlpHqiSaJU2a8rcnfD1XTbo8IMtzQUL2mKV456X7EEJ4mNX3G6ZkbZLqJFzUgz6KNafp3RgdZ4ue1hvOJhOPU5fz9/AKbVBdh1YpndAAAAAElFTkSuQmCC)的所有token对应的视觉语义信息。

方法：

\1.  ![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIcAAAAoCAMAAADjcxkDAAAAAXNSR0IArs4c6QAAAG9QTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgA6OjoAOmaQOma2OpC2OpDbZgAAZgA6ZjoAZpDbZrbbZrb/kDoAkNv/tmYAtpBmttvbttv/tv//25A625Bm27Zm27aQ2////7Zm/9uQ/9u2//+2///bFWaqUQAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACP0lEQVRYR+1W3VrCMAylQxmiTsRRfyawsb3/M5pmbZJBRuDzwguXC+Dj9LRnyUm62WyKKQNTBqYMTBmYMjBl4F9loHt/cIs/eeLaZauPdHKTZxv4XTuO+8OZLAO2HmOMfizdc8/tSvcWvn34Az92WnYM2NIxSu/KbIvkJp9/oRwoTa+pyVHYIAzYknGBXsWENDlWoX0BWW0RNDXLXqEMA7Z0XKCzDswHRu0UZ/AZBmyJ0elJR1vEAsE21eW+MWBLh073vT2DN8kO4qe2qQFbOlQ6+VTokKlRNjVgS4ZO78poi31OMyy2ztiGBmzpGKHX7gn6BDo1zhG06cWxasCWjjF6k6Mx9vlj2gGHDcZOad1+yEGEe8DdfVrnnuJELx13KDx8vuint0/9QpbZrwcr44YEe7dJ0+8GLWxIHGopyB/s036KgcLHQyUVR0qCZz5sQ+qvlUJ0mJZshTg6Q5bTgJdTjHSIog7HkI+ayVJtEcpcYyarNA9VepjXlYvEdL1JQVwNRQcQRJLaos8tH2ToEPSweVskgyXbxPsldI6jk851DGBYHC+Aa3VIul90u2V41cA4ueeGZSYdFQ9bsYLNpeO0VIMhcY6vEtLB/hEHJR1tQU0tZfh57Fodp6UqDK8V8s1Cu1/4OaIVKuFsFsK9ouO8jUavsm1yFyyUbYTvhTKgh07/EnCNtfLnL0vXtbAHa0G3feMJxzUX/vQ9ORQQQk0FNjrCosTXnR9X4RQ7rrNX7LZsdfNcvum0afGvMvADztIq5cHEW6sAAAAASUVORK5CYII=)分别与![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJcAAAAoCAMAAADE3ZjrAAAAAXNSR0IArs4c6QAAAH5QTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgA6OjoAOmaQOma2OpC2OpDbZgAAZjoAZjo6ZpC2ZpDbZrbbZrb/kDoAkDo6kLb/kNv/tmYAtpBmttvbttv/tv//25A625Bm27Zm27aQ29u22////7Zm/9uQ/9u2/9vb//+2///b2QlmCwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACdklEQVRYR+1XXXfaMAyN0410sIW1a7ZmHy6sCUv+/x+cbEuygxXR9onT4xwewrlIvpavrkxVladUoFSgVKBUoFSgVKBU4B1XYP75yWyuYn+Dqbe/iMnY1N/8+2DgeRAJKpAWdmGzQtZTZ76EqLljLgdjAsP8UaBKw3RmQuTc1Y8+aGxu/mD0YD4+ryRSICjYatjFguWRFgs2NozZdZkpUKVhOjEpMvLievV0tnk2Bao0TOclRRKvqcUDBaXRW5ZNgbSwC8coZu1J7vySKO08oQKlAn2l2UhZI1fmNazLS4FA9m81Pyly7lBWx4bSXoW8YJufwRTAvdDHrkRezri8wo7NLshiarGCh9vgbPFByA0s8+G3iP2TMF1vlLUz7AgQMDSbYKI9diHa43G/+Jn/CUI9jINMq4hZh9HOXqZ/8uO5SwTK+gL7CTMxGMewe7Yp/QSqehdP26C10W+sx7JIjWF0KpJSemrUmHFOEi9ul2SE0toiNnd+dDA2tW7Lg6+/pWGVR46gG2uwq3ktktWhoQ7IeEXIqdAXnbMn2N/vW6+MF/LiSLfe1JJuyRVwPvo7R6jnOa8EgqYN05TWjhgUp757Ba8Y2W/mwy1fZIS5jWIgXja/jLEqBcy1tictYiy0DIUNmWQARtWdixV5TS0aSNTu3N8ElxCw0DqgpxUMs+To2DzAhxfJ5yN3WCBqky5BiHsxx55+EC8hLunKHLX1I4o27JjKBBeKxS0VGnTl1jr4g+3Fq7ar5Kl9ywWxhyAwmCe/6GkfxbP43+FOmzsg2Se8Qgu7R74MHb8Cslu77i4TLb55Vz3t63vfTfX2bJwokQW6+gr8B4thMsMsCrrkAAAAAElFTkSuQmCC)做交叉注意力

![img](data:image/png;base64,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)

其中，![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAAAoCAMAAADAKEjWAAAAAXNSR0IArs4c6QAAAJZQTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOgA6OjoAOjpmOjqQOma2OpC2OpDbZgAAZgA6ZjoAZjo6ZrbbZrb/kDoAkGYAkGY6kJBmkLbbkNvbkNv/tmYAtmY6tpA6tpBmttvbttv/tv/btv//25A625Bm27Zm27aQ29uQ2////7Zm/7aQ/9uQ/9u2/9vb//+2///bzM0SwwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAC6UlEQVRYR+1Xa3fTMAyNM0I9xiArEMbD7VbIWggZyf//c8iSbMtpHi7n7Fv8YctpZOnq+kpysmxdKwMrAysDKwMrAysDKwMrA5cwcNq+HzGvi6/xr393WqlXH1M875VS+Xew7Cv1Cf61sFONBZl01lc5hG9gm1uvf6PxacsPtPVJF4es36vbFFiGQFm3FlV2VOodeU1bXYmxjU0F/xzVhnf21dVP76RWaAc5YLiF5a0ZVaujDJe2c+S+AihEd6sxO7sYsX1sNSNE5IuroRza6zfEVZ2Ui3fbUJDuDhjoShu5vQ5k1OQTATOY2lM5B41RmY1BD13p+F/Mh6KJQ2JXYqMnq1HOzlyAChIkVEZEmcDV71jWgL/VIokRGgwzH7BEJyhrhKuOgpKOzAakiqJYPHU4DF5gWkuVUF7R4vdc4HSUZ0Yj2SMqqwX0aZalfnx7CBRJIF15LsmGzqvV7lV4mlUIogKqMku2qJ940y6uHEdRVOe+zMRWruggKy75JdHafVg2gKqvJqjqSqpUt5xcIlTMSyROj4q3h1qcx2XLxFJlUTX+CE5bpQrR7mKuqAWgSsSheR2L5IaoBnxOqh1Q/cIOY/JvthXiqqG/9/vJzuVZkahGu/YAVSpVtv9+RjAm/+K6ArXGrpyqx1B5Qu2eQHk2jN8VQloLxdg8CI2fytz7phtqwCI6g++hNc8uIp0yg5eH7Ple3SaOWCCVzs349stTJOqQkTgB1fM9qi7YgB9HdR06sSsLuEBAk7s5zGs8vPVtLRDArhjciKM/WhWPLHeve4jqBrCvVzGeU/vnFG4325Lm9Ah0oUc/nek0LxqxA3hc2DLPaeKj8UxmoRXHLrCtH5MufWPxaEKPTLUx43PwnuMh4karPFXu56HsqcDFYHFO0066IYtlrn7s7AQ+6SJcRVNlPmN3hMv78Ftgxvy0ja4Bjc7tJ0NzgYdEzJFME/e8vBmo5fEh6SPp5bGICO2Hm8Hn3P+H/wd3iz9w4GWCqwAAAABJRU5ErkJggg==)，![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJcAAAAoCAMAAADE3ZjrAAAAAXNSR0IArs4c6QAAAIFQTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgA6OjoAOjo6OmaQOma2OpC2OpDbZgAAZjoAZrbbZrb/kDoAkDo6kGYAkJBmkLbbkNvbkNv/tmYAtmY6tpA6ttv/tv/btv//25A627Zm27aQ29uQ2//b2////7Zm/9uQ/9u2//+2///bdKb0EwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAC3UlEQVRYR+1Xa3ebMAyFNInbLht0rNvidhvQDQf+/w+cHn5hIPZOes6+2B+SBmTp+upKcosir8xAZiAzkBnIDGQGMgOZgfdmoK8/hS7b/Tf3aChhfS6KFr8Xpgs0r2C1O8PjqcFdhRJJ20I/U7MjDCY6v+/rwx9r2ZXlE8Z5Lnf4HVuSYaFHxFXA9o/OWWy3fj9WBoCOrp9Pzd0v42IoyWas9j9SvLZsDnQxLiW8M6Y4oM02vI5uNjrAkMAjmSa6147U/QPjapm+f1qDEwxHd6tlr7Ak/jU1x8RkaFzySPuA5rnfFHx+tmSgaUsYKPBcXOpTikO0YVzq/sy4pBPEFQ/TK/hXdVl+wNMrYc9C0WdL6geoj06EhUh1Ype/l/Ukj8yzWuxcQ3fBOsPkdZS11nGkRHgu85IRmKTGWSNcQBfjkimqvGD1UYLGCmEw07SGQF7uCSR4kou32/gIF9BVIOFKbBzoxZMN54oETbj83IXysvVNRkqkFxXiQroQ12YRjxV3E1pUcqz1EJeF6GSq+45hNt7pdRTMB9KFuAZ9HJgVEFXSJy+PLx4MHI6KxuOLo8+6lMbF5RV0Nz0fVnUPuN6QLsD1vTF1RUUEHtc6M8PglkVp83At4to8svz1sIurHlNxeCY4cvfV0EP5nJrTagv05KWrz+neq8x5JRhAYdvdRgjS4exB2kzysblOX7akgMFJXi6YNnUPXIUy1E6w80EHizMGvjh70qkJyrJ/3Bz6sOP0Vh1+d6a6bF810YvWdTGSBDUvAAYkpN0mvJR7XQjvSFca2dQ9YJzHJ51nM4dMdL8NeoM7zlHMAqp8RSn+LjeOOTvznI+V/T03jAW+/h7lZSp+w9JMPX7tD2787drzu9JFQzLkYAYwBBKEt3el0O42voj75c3Ac+rdIAxjfI/mJe9+vuBA68XeXldvg8RqwWKGz+0rzwqZfe1G6yDoCj/4/3fcjit7+N8M/AUgfTqNYiJyjAAAAABJRU5ErkJggg==)，![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAAAoCAMAAADAKEjWAAAAAXNSR0IArs4c6QAAAIRQTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgA6OjoAOjo6OmaQOma2OpC2OpDbZgAAZjoAZrbbZrb/kDoAkGYAkJA6kJBmkLbbkNvbkNv/tmYAtmY6tpA6ttv/tv+2tv/btv//25A627Zm27aQ29uQ2//b2////7Zm/9uQ/9u2//+2///bbYuwXAAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACyElEQVRYR+1X21LbMBC1kxBBS+uA6QVBS+3QyrH////YqyQrsVEGZuiD9eKMrd09e/bsSimKZS0MLAwsDCwMLAwsDCwM/McM7HdfU3TN5sfHAh7q1QkE+93FP8Y11GVZrv8URV/BD307jfkRdq3u2fAWHp2BF0dpv5JzX0kgB8bkRsEgElyHqlz/wh/g/3VQRWEZVAEOyV1bll8kw1z+h1qDo/VNZObhQpgtve8rv3fOfcPYkWNC1ZmcXEYeXSDXJUw0ylwjqFxE5Qws8dNdXvH+hqk7Y0VUFRpczT1Z8mGo83IWVHZrCVVfMdNnrM4EE5tq0kqSjrnKzZlRdZf3jMrmlH14vAaTXVl+xuI3AQn0YsK0fuQwfTVqJGoOv2JT1pHdgh4BVWcy+u+AHY9iaokATodWZ9KkhCORa1bOXt1AFTu3GWU/4BwgwVBDxfwohlB/bR56diZMjXmJ0HagqkAFTJo9pFWi5jpCdSQr39IYJlfqMgmQKkQ1aQYj2ZNI3cR9l6LytIVKKVe41eW3N5YCqUJUbIbj/ZYGWChn4IrPAA5GEo4qqCMyyi5C9XssdYg0rXZA9YxUAaqfNbc4902YyyMJMAgenFywoPZ0hlJgP9O/5bS3xILgd2RoV9/FjBuRynq8GBXJSjouTIZoRqihvvJnx7zK9StIhstt/alMqIZ6YkZgHJKVnOcATqaovmiiE1qnKHzLaG8PGbazU0tXDVw069yUEzC4fq4u/rZGxOtPnNZIpza+VtHxnC91gKAJRvLAU6evJkfL0F7hPP50o1cLOZ1Ju0RwmHr+dM4r3NyuAVRPbTm5xsHi49lzLayfU7Z55IDKzfeLqkX8JO3qZ3EK922E2c1u9mg4ija+IevFYG82otS3wRFrvThOOYvvLrJnH+Vh108PkJV7538ToYdO44oun6c2OLOKr8nvQtTi5EMZeAFFaTqi5yOhnwAAAABJRU5ErkJggg==)，![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAoCAMAAAD9luv1AAAAAXNSR0IArs4c6QAAAFFQTFRFAAAAAAAAAAA6AABmADpmAGa2OgAAOjqQOpDbZgAAZrb/kDoAkGY6kNv/tmYAtmY6ttvbttv/tv//25A627Zm/7Zm/7aQ/9uQ/9u2//+2///bOahxswAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAATUlEQVQoU2NgGAVoISDFzwgBrAwMUtxQNiMHA4MIuyCDOBtQFAaEQaIwwMfEC2dLcjILwTmiIIOwa2HkQtLPyCXBAzNCjI2RRYCeMQMAYEgB9PjM4QgAAAAASUVORK5CYII=)为文本编码器，![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAoCAMAAAAvxuGtAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAAAAAAAA6AABmADqQAGa2OgAAOjoAOjo6OmaQOma2OpDbZgAAZjoAZrbbZrb/kDoAkNv/tmYAtpA6tv//25A627Zm29uQ2//b2////7Zm/9uQ/9u2//+2///be9MAfwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAi0lEQVQoU+1QzRrBQBDLUIv+sEqXWvb9H9PMRKmzg4sccsgk+bIL/PHDHyjHGsidyHbkiltXjbhKgyQrCq0Kd9LypEKJiwMwyB6TMpi1RLvSU6Jdc9CQdhkzZL1A7zyrycGLtbNhDfNukvrcVpcULE4prUWx2T0Hu+hrPtC/AlPO982RA1/4Bvd9hQfECQeM7gXkOAAAAABJRU5ErkJggg==)为图像编码器。

\2. 将![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAoCAMAAAAR447jAAAAAXNSR0IArs4c6QAAAI1QTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOgA6OjoAOjo6OmaQOma2OpDbZgAAZjoAZmaQZpDbZrbbZrb/kDoAkDo6kGY6kGaQkLbbkNu2kNv/tmYAtmY6tpA6tpBmttv/tv/btv//25A625Bm27Zm27aQ29u229v/2////7Zm/9uQ/9u2//+2///bsrONUQAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACE0lEQVRYR+1VaVPCQAzdFJD1wKJQ8CiKFFR67P//eWY3Rw+GGRxn+sXuByalL/uSl6PGDGdQYFBgUGBQYFBgUKBWIINpr3JUMVwd/8CYwv3vvNOxFcI0eiVfNc5fJRCXiNOFtMX1S8yE1Ylx/g7FXkijMJdMq3i0889uw8VU4/xlF0DOOOfRKxNmEM5op4YP4v0GYLI15nDjK32wMPHBKQQbQEpYri3AHUK74BZzFd8bzVCqUZelsEh2wMT3s2MGy80CqUJLK6SKuYQHe7U1hfVidcFNxgwB4izEGgH6++rSLzbS7dKYnAhPsDm1egqI6YIbhIXFlhbCwvI8isEvsiCaSwIVEzawgQjfBibCdsANwtQr0AGrF6Y2Ne5rDXf+Ss6JU+CLfQCBgVXADMNjG2wCjT859QlQdCKHGqE1bh+2AUs5iRpdrJaWrmqDXcJzJwZ5n5ZQb63F4kwU6xIKnjOjphGNJG2VNOMGI7S+FqO9Q4hdS8gx11JyCakNWmDl02XRIHRPO2L2Bme4fzypikI4AG4WSbxbb2ldXizlPLQ0yrEtV5hrw8D/y7Wfe50NWJarZQ1BQvfGPqacs2QySAQ2fvbwJNgRXkq/LGCGjHtcI2F5q/E5BxgvwqdEtYTJcwOCHR4FAEYN0eyb5OuA0z99jbQiFxt+m/V6Ckvbp7cjw9AbYTr62PSaY26jRW/Z/SuiHzCyOFcLLp6rAAAAAElFTkSuQmCC)与![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAoCAMAAABkbjJAAAAAAXNSR0IArs4c6QAAAGxQTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgA6OjqQOpDbZgAAZgA6ZjoAZrbbZrb/kDoAkGY6kLbbkNv/tmYAtmY6ttvbttv/tv/btv//25A627Zm27aQ2////7Zm/7aQ/9uQ/9u2//+2///bMSTHeQAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAABQ0lEQVRIS+1Uy1bEIAwtnSpqrVZlfDCVwfL//2h4JaFQt26aRQ+Q5Ca5Sdp1hxwMHAzsMbBMDw2VHl53KXNzD0ojSG6+g/EypUPluo5BowTECp+LuE1Gbj59tUKldzeDoZvFc9dZCZ8oCW/rZzw0aB/fvInHtXdwTKI9yFaK8EZsC8iB3DlV69O2MicPF42VILTqfVBIOolPSsfUoqg6k6i/3H8wdG62jgG0EIOhER16Q2ZW1tRamUuMWYZEmQ9hKnRGn8hp5RM6Gl+RP/QhQB6niJmLQh9GFuOAojMWEJ4ZMnfsqBbEOerB5+clskA9hb7lKjXxh2xdpRjec7lJH1qdzgopaA9pmlHeyHXE2WjOKPBaNZKWYWcXGjuiqePtnQuzUC6+On2e/doscmiuaahjmYrNMrJ/glfzxz9kO8r/d/8FThMUH+H8k8MAAAAASUVORK5CYII=)在最后一个维度拼接,记作![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPUAAAAoCAMAAAARz0ymAAAAAXNSR0IArs4c6QAAAKhQTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOgA6OjoAOjo6OjqQOmZmOmaQOma2OpDbZgAAZgA6ZjoAZjo6ZmY6ZmaQZpCQZpDbZrbbZrb/kDoAkDo6kGY6kGaQkLbbkNu2kNv/tmYAtmY6tpA6tpBmttvbttv/tv/btv//25A625Bm27Zm27aQ29u229vb29v/2////7Zm/7aQ/9uQ/9u2//+2///bVdibBQAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAEQElEQVRoQ+1Y21LbMBC1DLQGWkKa3iCkLaaFYhJaUsf5/z/rrvaileKAPQMMzFgP4Dgr7TlnL5KSZcMYFBgUGBQYFBgUGBQYFBgUGBQYFBgUGBQYFHgpCiwdjJ3rlwInyxaT4xYw1d53flsh4Dd3atOM48+dmCzdW2tXxR87LfGYRutpDvR8KHgwwcUkMK0LwzrLyv6YY9YgXLRgX0KlawtU91WasXfvl/F/5spoPdWMTFhX/Z3GrMtdlbHMzwmtPmwHLyYQKZ7Unai1ZGbrKeTfeupOs6wu4A8NVgSeDOvb2aHPid33UgGdPEes6/0fJLbxEZxtXa+DSScskNk+VZoPoF0zxtjW+0HGCmXAoaybiTu6zDDWtzO310Nwyxo0Jl+g9AWnlj5sx93BpBtpk8RY22mtqbjCGtIBVaIMr/r0ZMt6mZ8za98osbfrAyrx68C5vSsotgNENC/cHiqkJthNfayybDUrnDsC09Q4pQ+K0cCeWhems7b0VSkkYb0kosQavGsxsBfbFJ2zxWdYN+NjziusKjYKpVoXwBi7y83oDpLt4gTceZRq0ox50rx4cwUcEFNqHNOGaPEIQWOLcoME0wsZXlI6EGsOfLesMqwrQCkMJNNVBi4mlrnMD0FYnrthy8kpuCPjGNX8HaojEbZEVUEzQbBKrB+DdV2AZMJaocgDf6G6IlJGYWy99tR9JQb40RhvxkI3nmgHoEyJh7CV/1zKkuGYaM04On5si3yIdYluEsQK3UdkDZ3yCHlxdDk2CptbcAgFZl5inHk3dujOGLFOcPkJKWsuZfJPge/LWkvfx0mTTR58zzr87BsUJ6WgTG213CnklApivJ4mrVnrI/QHAuAlw4k6IWUNS7vRH9q5PlI8ovFwN5PFicJmWUfNhdRlEGorGw8DlhyNjFNgWiZGGOLact7ZYA2n9k+wr2A8vlA8Og7JpIq9EGQ9B4St0aIgCbSsORghs7msqcQi401U5jxplA0ZYGak3Yy/MitA8PvUtZ4ADOv1t2uijw+M6OZryAR+pSYqIO+fVMBpD6C0N2UbdigDX88oUFm6Dcv399w+oi1/e+DZvdxbVhPfFCA7r1ZnEHXzAO9XMzykSCYA69XZaTCBpdY/eU62mnByyF5Hxhlujynr1YwOkwEyNFVpejzBZ028JJGKb5p9upk/LGBm+yVGQPsGDl4eij4sJnDGP/EdQ1Pb+VuvmMAquTcA6Vw++kuoEuOSyiHE+h94uiRTPZF6PEybJ3hwSSnRrGj0Yd0y/Yle4fkPh94kIj+89dl3MsHOSTI8Nu9T109EcmNZvjk241Gbx+j6QQbhqtl603wdseatoqKItyRoetGSvSWkf3S/Tleo+57NniXc5c7vi/RqZB3TL0hmyIRF4S94HP9tP/hAX8pxl3loPPOvhcsiP7kf0mISqcITllt/LXyI4PD9oMArVeA/bk6DI6A1T/oAAAAASUVORK5CYII=)，然后将所有token在token维度拼接![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAM0AAAAoCAMAAABq645qAAAAAXNSR0IArs4c6QAAAIdQTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOgA6OjoAOjo6OmZmOmaQOma2OpDbZgAAZjoAZjo6ZmY6ZpCQZpDbZrbbZrb/kDoAkGY6kLbbkNv/tmYAtpBmttvbttv/tv//25A625Bm27Zm27aQ29u229vb2////7Zm/9uQ/9u2//+2///b/rm2QQAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAACYUlEQVRoQ+1Y2XbCIBCFWKvWamMXjZUuqVqTJv//fSUsCYEAQ9u89MDxRTPbvQyXiQjFFRmIDEQGIgORgchAZCAyEBmIDEQGghgoMF2T9yCfUY3zpqDri8xRpb2vntQFnnUWMFeYlSevK0g579AgRNQKQ9BAXUMSWPPbg/TR5PgO3Ay9vUEI5gqz8tRgD9KhOe+XTePhq9tnECIFDcwVZuXJ7Q4i0VQbvHplBJ/3eHoA4GnRwFxhVr4z46lSoKkz1mN8D3OQVEk0MFeYlQeMN4hAU3AAHA1VjV0blwlxu5Ju1yQau6taG8zKKzy2KoWjQEO4UHM0ggJvaK7QMFeYlSelN8i/RCOOiuw0paGsdMlOg7nCrLzS3Os0s0qxN+KocDRiQ4GdNuh6XGiyOGBVv9xgPH0DyKc0GQqSqZIlFbqc4/UnV+h7vGqHHYS8KoBM19PGVEXTiuAt9Q2a9AaqrDNlwOpuz9MDpYqu5SOMLuX21FyL9SUfKFJPQJoyCKSple0zqqxSZXwZabKRaLTxx5x/CIPd3cTscuBynsuB2BmkpD1Np2e+QSNNnTY0+sBYpayMMDS9IE2mKhXHT0UTNrA73wiG0RgJ6oxP8CFotCBkVh8X2/7tGSAs0lTf/14IiSZXpgozR52J4+U2cz1tsHVHr99pIaAgaKp07QhZkwkXHLeZ82k539GPTDIumtz5utTqmdvM+TRPDuLsmSrwV3tTZ4lsZXvIgnUh6QbckOzSltCDR3Xxg6f7zd7Y/uVg5xT7XmPpbNuswPtGQ8zuzq9N8kR/1/7l+Ak30ScyEMDANy+7Rd9H3GtaAAAAAElFTkSuQmCC)，输入到transformer中抽取出![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAMAAADJ7yrpAAAAAXNSR0IArs4c6QAAAF1QTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOjpmOpDbZgAAZpC2ZrbbZrb/kDoAkNv/tmYAtmY6tpBmttv/tv/btv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///b2R0GjwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAApElEQVQ4T+2QyxLCMAhFQ6uiVWt8UUXb//9MTSCFjDvHpWwSEjjcSwj/+PUGGCTWZ08eoL2GcEPYu1eG5f2dEqzcI8EmZfqnH1H6SBokpr45pDNKg8QDcwXncSU4DXieUOpnZFK52BrQkLkkKmLsjDX1KqCWp0iV7oYkpFkm0PuATjMJPu9tdhKd0cIbO2fUDPuNFiGV02K4vRw/ahmbXaX3q+QFgwIGVYNkoR8AAAAASUVORK5CYII=)的所有token与目标图像对应的交叉注意力![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUAAAAAoCAMAAAC4ntMbAAAAAXNSR0IArs4c6QAAAIpQTFRFAAAAAAAAAAA6AABmADo6ADpmADqQAGa2OgAAOgA6OjoAOjo6OmaQOma2OpDbZgAAZjoAZmaQZpDbZrbbZrb/kDoAkDo6kGY6kGaQkLbbkNu2kNv/tmYAtmY6tpA6tpBmttv/tv//25A625Bm27Zm27aQ29u229v/2////7Zm/9uQ/9u2//+2///beNG1MAAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAD9UlEQVRoQ+2Zj1ebMBCAk6or/qi4tdVt4lZptwmF///f2yW5OxKgCVTLq++F5/NFPeDjy+UuVCHiEQ1EA9FANBANRAPRQDQQDUQD0UA0EA1EA9FANBANfCYDhYTj4vUzIZ8XayHnNlDu/ngOrGeIZGtxBVap/PL2HmuZvH/P6T3nniGSQ+kKzC4TEpjNnk0gDzxmKKZe01kfpvFIJKY+AdJhgeX1zxQFVp2BRwkHf5g2vtCRSCckaj2jnYH1el6lpqHUL1gMeeBxMyTmSLVHIp2QqP0gtsBi9owCc9WbVXfmgbb6+0bKq40QuxtVKneJvFK2OQbKFZXA/VMi5R2EtoNHigwghYhEL5KLP5LII7BK7+GGmIFUzKwSUiYgbweZuV285XL1sgR1uoVzTJViCdwlXzaiTNS12sGjeANIYSJ4oA7Su4g6+FYG5vC85IJEslEBPlR5NN+hs9yuhMCTO8GF6eWZhJh28CiBfqQBRMzvIjn4o4g8AssEdiAksExwe8gD/EuuF2m91rmHAq1gLQ7+qs2Z2FbwGFw/0hAimnAXycUfQ9SNbTIwUwuu9ewsQaXeXNR/n+SdUoQ5hymGopRQbQyzFDJQ/+gGj8H1Iw0h6kc6nsgjUL/TqUMnD62+ZqBbxe3Xjb6EyTlK13Ywl0ZzLScYZujAi+PuGjeeDBlAGkJE/C7SECLuT4EZpwys12YDaGT0lEC21CxOzDQOrtfGDWaeaSKUxJSWsDFpkHJ+7/nz0BEbQhpABHPch2SWTC+RIKRMLrEN+g2SwByblXl4unYzcDf0hp1LIGpoli6WQKPKCYa5sV72WGABjb2dmQGkIURWNbGRPESNQAU/4C2MGylKsATW318NgBrQWth+61Q1juHJ0JNAidkqOCWsVFh8xm2TgTBGgXQVfpk4hIQZ6COiOcZ+hig+IgdJ6CLMF1HPpDKn0IslN1sNxM3wifYP+tew+jb7R9DAA6Ny/6T20byXkav946qJgWvVv/AksX/AnKaNjwnWnqpUX8YvMIg0gEg9XhfJR+QIrFI9z02jPSQQKrt5h1Abd7kAg1t4y9A1nQcCqpS8XOpCyWtXXv2wYuAyMx0A0yBni3+meLSCs3m9u17qlY0HZp6bgUOQwkRqV9FFOkTURqIiHBZonnSSQ01R84lN3xKGl5xJSOgmLpGVgdSAYLF6iFofqJ4cvUxW8EW36RFYpYuTQzg3cIkagXV2YeqMn2hqgdBasbIoth6B+Ud/IhuaDpeoQeIO7CeaWmAGrQh621ZVQUcg7ErM76Y+XCIWWOh1mwXLycT/VNLbaGjQajNkH7p78YdhUzo8QKSbmF2up2SK94oGooFpDPwHnkuLO2iUGXkAAAAASUVORK5CYII=)]。

\3. 损失函数

由于该模块的输出并不是完全的图像信息，而是文本与图像的交叉注意力，因此损失函数被设计为：

![img](data:image/png;base64,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)

![img](data:image/png;base64,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)

![img](data:image/png;base64,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)

其中，在代码中，这里的Loss目前选择的是1-余旋相似度。这个模块与视频生成无关，因此被单独训练，并且在后续被冻结。

### 1.3 文本语义和图像语义解耦模块

由于（2）的结果为token与图像之间的交叉注意力，将其直接与文本语义拼接会导致文本与图像不解耦，因此这里我们可以设计一个解耦网络，我目前设计的解耦网络就是让文本与注意力图再做一次交叉注意力，让文本语义关注交叉注意力图抽取出图像语义。该模块与CogVideoX一起训练。当然这个模块被设计的初衷是要做解耦的，但目前还没有设计损失函数来约束其解耦效果

### 1.4 多模态注入

直接将文本embedding和image embedding拼接输入到CogVideoX中。

### 1.5 新加的Classifier-free guidance

在我们的pipline中，新加了Classifier-free guidance（参考至History Guidance）：

![img](data:image/png;base64,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)

其中，![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAoCAMAAAA1+gEjAAAAAXNSR0IArs4c6QAAAFRQTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOjpmOpDbZgAAZpC2Zrb/kDoAkNv/tmYAtpBmttv/tv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///bQRRfPAAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAm0lEQVQ4T+1R0RKCMAxbRRyoMGXgVP7/P2Xtym1QOB69gzwuTZamSh341wZs/lqJtp11QCiebJdoW8gapToN94E2YRbfPBxgCguXIE60FspoyM/FmQ1aDlp+jNm+OtWeNWQx0b41atyYI2nC+TSfhyaHKWiH801sj7+Vm/1eeW+JD10sHCV0IbN9RV3IaPVYwnwAz8cdLXvsg/kBTsEFnaMDVI0AAAAASUVORK5CYII=)表示正向词，![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAoCAMAAAA1+gEjAAAAAXNSR0IArs4c6QAAAFRQTFRFAAAAAAAAAAA6AABmADo6ADqQAGa2OgAAOjpmOpDbZgAAZpC2Zrb/kDoAkNv/tmYAtpBmttv/tv//25A627Zm27aQ2////7Zm/9uQ/9vb//+2///bQRRfPAAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAAkUlEQVQ4T+1R0RLCIAxr55TpRHQw2eT//1MobOew4wO45YU70qRNC3Cg9g1YjOhebFKDpwFgFHj3tEq19Bdg8fz2j8YLJ9Z4/SnKKxRZei1ZZHCyeYQvFS0yTII0dp1jw9swzfwU0eG/bQjR9kxTgKUtf/TPbcnN8WkXvNTH5IKkYifjLngYUdDS+QrW+7YVMl+PzQQtWC01GAAAAABJRU5ErkJggg==)表示反向词，该前2项：![img](data:image/png;base64,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)为普通的Classifier-free guidance，最后一项![img](data:image/png;base64,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)确保了当前视频的生成能更好的依赖于过去视频和文本描述。

## 2. 环境配置

```bash
git clone git@github.com:yankai233/multiple_prompt_video_generation.git
```

### 2.1 下载第三方库

```bash
pip install -r requirement.txt
cd Script
```

### 2.2 下载预训练的模型：

|                   CLIP4CLIP(video_encoder)                   | https://huggingface.co/Searchium-ai/clip4clip-webvid150k     |
| :----------------------------------------------------------: | ------------------------------------------------------------ |
| **CogVideoX(tokenizer,text_encoder,transformer,scheduler,vae)** | [THUDM/CogVideoX-2b · Hugging Face](https://huggingface.co/THUDM/CogVideoX-2b) |
|              **feature extractor transformer**               | [laion/CLIP-ViT-H-14-laion2B-s32B-b79K · Hugging Face](https://huggingface.co/laion/CLIP-ViT-H-14-laion2B-s32B-b79K) |

将模型放到**Multi scene/excluded_dir/local_model/model_dir**，格式为：

```
model_dir
	|------Clip4Clip
	|
	+------CLIP-ViT-H-14-laion2B-s32B-b79K
	|
	+------feature_extractor
	|
	+------scheduler
	|
	+------text_encoder
	|
	+------tokenizer
	|
	+------transformer
	|
	+------transformer_t2v
	|
	+------vae
```

**请将CogVideoX中的transformer重命名为transformer_t2v**

## 3. 训练

### 3.1 数据集配置

创建数据集部分请参考**论文**：[[2503.19881\] Mask$^2$DiT: Dual Mask-based Diffusion Transformer for Multi-Scene Long Video Generation](https://arxiv.org/abs/2503.19881)

```markdown
1. 从youtubu下载视频,这里我使用Koala-36M的链接下载视频
2. 将视频裁剪为10min内
3. 使用PySceneDetect将视频分段
4. 使用Gemini大模型描述视频内容（Gemini可以连续描述10轮视频，因此只能保证10个片段的描述一致）
5. 数据集格式：
data_root
	|
	+-------videos
	|		   |-------video1
	|		   |		|--------片段1
	|		   |		|--------片段2
	|		   |
	|		   |-------video2
	|		   
	|
	+-------prompts
			   |--------video1.json
			   |--------video2.json
			   
[注]:video1,json内容为:{片段1路径:描述,片段2路径:描述}
	
```

### 3.1 feature extractor训练

#### 3.1.1 参数配置

详见**Multi scene/configs/Feature_Extraction_Module_T5.yaml**

#### 3.1.2 训练

执行以下命令训练：

```bash
python train_feature_extraction.py --log_dir ../../excluded_dir/output_dir/logs/train_feature_extraction --output_dir ../../excluded_dir/output_dir/logs/train_feature_extraction/ckpt --resume_from_checkpoint '' --configs ../../configs/Feature_Extraction_Module_T5.yaml --device cpu --mixed_precision fp16
```

### 3.2 CogVideoX训练

#### 3.2.1 参数配置

详见**Mutiple_prompt_mutiple_scene/Script/finetune/schemas/args.py**

#### 3.2.2 训练

执行以下命令**训练**：

```bash
bash train_CogVideoX_ti2v.sh
```

## 4. inference

```bash
python inference.py \
--model_dir ../../excluded_dir/local_model/model_dir \
--multi_prompts 'Actor 1 is running on the playground.' 'Actor 2 is skiing on the snow.' 'Actor 2 is running on the playground.' \
--height 480 --width 720 --num_frames 49 --fps 15 \
--guidance_scale 6 --image_guidance_scale 6 \
--num_inference_steps 50 --device cuda --dtype fp16 --seed 42 \
--use_dynamic_cfg True --eta 0.0 \
--output_dir ../../excluded_dir/output_dir/inference/generate_video
```

